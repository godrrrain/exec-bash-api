# –¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å—Ç–∞–∂–∏—Ä–æ–≤–∫—É PGStart 2024

## –û–ø–∏—Å–∞–Ω–∏–µ
–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π REST API –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥.

–í —Ä–∞–º–∫–∞—Ö –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- –ö–æ–º–∞–Ω–¥–∞ - bash —Å–∫—Ä–∏–ø—Ç (—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
- –û–±—ã—á–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ - –∫–æ–º–∞–Ω–¥–∞, –≤—ã–≤–æ–¥ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ë–î –ø–æ—Å–ª–µ –µ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –î–æ–ª–≥–∞—è –∫–æ–º–∞–Ω–¥–∞ - –∫–æ–º–∞–Ω–¥–∞, –≤—ã–≤–æ–¥ –∫–æ—Ç–æ—Ä–æ–π –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ë–î –ø–æ –º–µ—Ä–µ –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

SQL —Å–∫—Ä–∏–ø—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `postgres`.

–ö–æ–ª–ª–µ–∫—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ - [Script_Execution_System.postman_collection.json](postman/[pgstart]Script_Execution_System.postman_collection.json)

–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è Open API - [open-api.yml](docs/open-api.yml)

–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ `Ubuntu 22.04`

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
1. üíª –°–∫–∞—á–∞–π –ø—Ä–æ–µ–∫—Ç
2. ‚úÖ –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç: `docker compose up`

## –†–µ—à–µ–Ω–∏—è, –ø—Ä–∏–Ω—è—Ç—ã–µ –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã

#### –ö–æ–Ω—Ç–µ–∫—Å—Ç
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã.

#### –†–µ—à–µ–Ω–∏–µ
–ë—ã–ª–æ –ø—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö in-memory. –î–æ–±–∞–≤–ª—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö –≤ –º–æ–º–µ–Ω—Ç –∏—Ö —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–¥–∞–ª—è—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ—Å–ª–µ –∏—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

–î–ª—è —ç—Ç–æ–≥–æ –±—ã–ª —Å–æ–∑–¥–∞–Ω –≤ `aprocess.go` —Ç–∏–ø, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π map-—É –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π RWMutex.

#### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª–∏–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.


### 2. –û–±—ã—á–Ω—ã–µ –∏ –¥–æ–ª–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã

#### –ö–æ–Ω—Ç–µ–∫—Å—Ç
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–ª–≥–∏—Ö –∫–æ–º–∞–Ω–¥, –≤—ã–≤–æ–¥ –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ë–î –ø–æ –º–µ—Ä–µ –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

–î–æ–ª–≥–∏–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç –≤ –ë–î –∫–∞–∂–¥—É—é –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –≤—ã–≤–æ–¥–∞, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, —Ç–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –≥–æ—Ä–∞–∑–¥–æ —á–∞—â–µ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –ë–î, —á–µ–º –æ–±—ã—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã, —Ç–µ–º —Å–∞–º—ã–º —É–≤–µ–ª–∏—á–∏–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫—É.

#### –†–µ—à–µ–Ω–∏–µ
–ë—ã–ª–æ –ø—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –æ–±—ã—á–Ω—ã—Ö –∏ –¥–æ–ª–≥–∏—Ö –∫–æ–º–∞–Ω–¥.

#### –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª–∏–ª–æ —Å–Ω–∏–∑–∏—Ç—å –æ–±—â—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–∏—Å—Ç–µ–º—É, —Ç–∞–∫ –∫–∞–∫ —á–∞—Å—Ç–æ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –≤—ã–∑—ã–≤–∞—Ç—å –æ–±—ã—á–Ω—É—é –∫–æ–º–∞–Ω–¥—É, –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–∏—Ç—å.


## –û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤

### –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ã—á–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã
–ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é bash-–∫–æ–º–∞–Ω–¥—É, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –ë–î.

#### POST `http://localhost:8080/api/v1/commands`
#### cURL
```
curl -X 'POST' \
  'http://localhost:8080/api/v1/commands' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "description": "–¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã",
  "script": "echo Test"
}'
```
#### Body
```
{
  "description" : "–¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã",
  "script": "echo Test"
}
```
#### Response
```
{
    "uuid": "9bc12250-78d1-4cc1-9ba2-a36d1685a007"
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã
–ü–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–º—É –≤ path `uuid` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–∞–Ω–¥–µ.

#### GET `http://localhost:8080/api/v1/commands/:uuid`
#### Response
```
{
    "command_uuid": "9bc12250-78d1-4cc1-9ba2-a36d1685a007",
    "description": "–¢–µ—Å—Ç 1",
    "script": "echo Test",
    "status": "EXECUTED",
    "output": "Test\n"
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥–∞—Ö.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ query:

- `status` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É –∫–æ–º–∞–Ω–¥—ã

- `limit` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤

- `offset` - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —É–∫–∞–∑–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤

#### GET `http://localhost:8080/api/v1/commands`
#### cURL
```
curl -X 'GET' \
  'http://localhost:8080/api/v1/commands' \
  -H 'accept: application/json'
```
#### Response
```
[
    {
        "command_uuid": "9bc12250-78d1-4cc1-9ba2-a36d1685a007",
        "description": "–¢–µ—Å—Ç 1",
        "script": "echo Test",
        "status": "EXECUTED",
        "output": "Test\n"
    },
    {
        "command_uuid": "4fa5e938-3d95-4051-9376-dbbb9510a49c",
        "description": "–¢–µ—Å—Ç –¥–æ–ª–≥–æ–π –∫–æ–º–∞–Ω–¥—ã",
        "script": "for i in $(seq 1 5); do echo Test; sleep 3; done",
        "status": "EXECUTING",
        "output": "Test\nTest\nTest\nTest\n"
    }
]
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã
–ü–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–º—É –≤ path `uuid` –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É.

#### PATCH `http://localhost:8080/api/v1/commands/:uuid`
#### cURL
```
curl -X 'PATCH' \
  'http://localhost:8080/api/v1/commands/4fa5e938-3d95-4051-9376-dbbb9510a49c' \
  -H 'accept: application/json'
```
#### Response
```
{
    "message": "command stopped successfully"
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–ª–≥–æ–π –∫–æ–º–∞–Ω–¥—ã
–ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é bash-–∫–æ–º–∞–Ω–¥—É, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã –≤ –ë–î –ø–æ –º–µ—Ä–µ –µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

#### POST `http://localhost:8080/api/v1/durables/commands`
#### cURL
```
curl -X 'POST' \
  'http://localhost:8080/api/v1/durables/commands' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "description": "–¢–µ—Å—Ç –¥–æ–ª–≥–æ–π –∫–æ–º–∞–Ω–¥—ã",
  "script": "for i in $(seq 1 5); do echo Test; sleep 3; done"
}'
```
#### Body
```
{
  "description" : "–¢–µ—Å—Ç –¥–æ–ª–≥–æ–π –∫–æ–º–∞–Ω–¥—ã",
  "script": "for i in $(seq 1 5); do echo Test; sleep 3; done"
}
```
#### Response
```
{
    "uuid": "4fa5e938-3d95-4051-9376-dbbb9510a49c"
}
```

### –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
–ü–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–º—É –≤ path `uuid` —É–¥–∞–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–∞–Ω–¥–µ.

#### DELETE `http://localhost:8080/api/v1/commands/:uuid`
#### cURL
```
curl -X 'DELETE' \
  'http://localhost:8080/api/v1/commands/9bc12250-78d1-4cc1-9ba2-a36d1685a007' \
  -H 'accept: */*'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Status OK`

#### GET `http://localhost:8080/manage/health`
#### cURL
```
curl -X 'GET' \
  'http://localhost:8080/manage/health' \
  -H 'accept: */*'
```